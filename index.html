<!DOCTYPE html>
<html><head><title>TARDIS Witness Constellation</title>
<style>
.witness {display:inline-block; margin:20px; text-align:center;}
.heartbeat {font-size:30px; animation: pulse 2s infinite;}
@keyframes pulse {0%,100%{transform:scale(1);} 50%{transform:scale(1.2);}}
</style></head><body>
<h1>â—ˆ Witness Constellation â—ˆ</h1>
<button onclick="chirp()">Chirp from this device</button>
<div id="deviceInfo"></div>
<script>
function chirp() {
    let deviceId = localStorage.getItem('deviceId');
    if (!deviceId) {
        deviceId = prompt('Name this witness node:') || 'Unknown';
        localStorage.setItem('deviceId', deviceId);
    }
    const timestamp = new Date().toISOString();
    const command = `echo '{"${deviceId}": "${timestamp}"}' | jq -s '.[0] * .[1]' <(curl -s https://api.github.com/gists/b1f561774c2d272175a35fb478ccb1bd | jq -r '.files."chirps.json".content' | jq .) - > chirps.json && gh gist edit b1f561774c2d272175a35fb478ccb1bd chirps.json`;
    
    prompt('Run this in WSL to register chirp:', command);
    updateWitnesses();
}
</script>

<div id="witnesses"></div>
<script>
async function updateWitnesses() {
    const response = await fetch('https://api.github.com/gists/b1f561774c2d272175a35fb478ccb1bd');
    const data = await response.json();
    const chirps = JSON.parse(data.files['chirps.json'].content);
    
    let html = '';
    for (const [node, timestamp] of Object.entries(chirps)) {
        const secondsAgo = Math.floor((Date.now() - new Date(timestamp)) / 1000);
        html += `<div class="witness">
            <div>${node}</div>
            <div class="heartbeat">ðŸ’œ</div>
            <div>${secondsAgo} seconds ago</div>
        </div>`;
    }
    document.getElementById('witnesses').innerHTML = html;
    document.getElementById('deviceInfo').innerHTML = 'This device: ' + (localStorage.getItem('deviceId') || 'unnamed');
}
setInterval(updateWitnesses, 5000);
updateWitnesses(); // Call immediately
</script></body></html>
